<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
     <!--Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-142145440-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-142145440-1');
    </script>
    <title>Imagine Act Game</title>
    <style>
        :root {
            --titlebar-background: linear-gradient(145deg, #0078d4, #005a9e);
            --titlebar-border-radius: 8px;
            --titlebar-shadow: 0 4px 8px rgba(0, 0, 0, 0.2), 0 -1px 2px rgba(255, 255, 255, 0.2) inset;
            --titlebar-height: 40px;
            --title-color: #ffffff;
            --titlebar-padding: 12px 20px;
            --titlebar-transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            width: 100%;
            height: 100vh;
            margin: 0;
            margin-bottom: 8px;
            box-sizing: border-box;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
         .dark-theme {
            --background-color: #282c34;
            --text-color: #ffffff;
            --titlebar-background: linear-gradient(145deg, #1e1e1e, #333333);
            --titlebar-shadow: 0 4px 8px rgba(0, 0, 0, 0.4), 0 -1px 2px rgba(0, 0, 0, 0.3) inset;
            --title-color: #00ff00;
            --button-background: #00ff00;
            --button-text-color: #282c34;
            --button-hover-background: #00cc00;
            --input-background: #2c2f33;
            --input-border: #ccccca;
            --receipt-background: #2c2f33;
            --receipt-text-color: #ffffff;
            --receipt-border-color: #555;
            --dropdown-background: #1e1e1e;
            --dropdown-text-color: #00ff00;
            --popup-background: rgba(44, 47, 51, 0.95);
            --popup-content-color: #ffffff;
            /* Additional */
            --link-color: #00ff00;
            --tooltip-background: #1e1e1e;
            --tooltip-text-color: #ffffff;
        }
        
        .light-theme {
            --background-color: #ffffff;
            --text-color: #000000;
            --titlebar-background: linear-gradient(145deg, #0078ea2e, #0078eaa3);
            --titlebar-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), 0 -1px 2px rgba(255, 255, 255, 0.3) inset;
            --title-color: #0078d4;
            --button-background: #0078d4;
            --button-text-color: #ffffff;
            --button-hover-background: #005a9e;
            --input-background: #f9f9f9;
            --input-border: #0078d4;
            --receipt-background: #0078ea2e;
            --receipt-text-color: #000000;
            --receipt-border-color: #dddddd;
            --dropdown-background: #ffffff;
            --dropdown-text-color: #0078d4;
            --popup-background: rgba(255, 255, 255, 0.95);
            --popup-content-color: #000000;
            /* Additional */
            --link-color: #0078d4;
            --tooltip-background: #f0f0f0;
            --tooltip-text-color: #000000;
        }
        
        .retro-theme {
            --background-color: #000000;
            --text-color: #00ff00;
            --titlebar-background: linear-gradient(145deg, #000000, #111111);
            --titlebar-shadow: 0 4px 8px rgba(255, 0, 255, 0.5), 0 -1px 2px rgba(0, 0, 0, 0.5) inset;
            --title-color: #ff00ff;
            --button-background: #ff00ff;
            --button-text-color: #000000;
            --button-hover-background: #cc00cc;
            --input-background: #111111;
            --input-border: #00ff00;
            --receipt-background: #111111;
            --receipt-text-color: #00ff00;
            --receipt-border-color: #ff00ff;
            --dropdown-background: #000000;
            --dropdown-text-color: #ff00ff;
            --popup-background: rgba(0, 0, 0, 0.95);
            --popup-content-color: #ffffff;
            /* Additional */
            --link-color: #ff00ff;
            --tooltip-background: #111111;
            --tooltip-text-color: #00ff00;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            position: relative;
        }
        .titlebar {
            background: var(--titlebar-background);
            border-bottom-left-radius: var(--titlebar-border-radius);
            border-bottom-right-radius: var(--titlebar-border-radius);
            box-shadow: var(--titlebar-shadow);
            height: var(--titlebar-height);
            color: var(--title-color);
            padding: var(--titlebar-padding);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--titlebar-transition);
        }
        
        .titlebar:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3), 0 -1px 3px rgba(255, 255, 255, 0.3) inset;
        }
        
        .titlebar .title {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .titlebar .buttons {
            display: flex;
            gap: 10px;
        }
        
        .titlebar .buttons button {
            background: transparent;
            border: none;
            color: var(--title-color);
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .titlebar .buttons button:hover {
            color: #ff00ff; /* Accent color on hover */
        }
        
        .titlebar h1 {
            margin: 0;
            margin-left: 12px;
            font-size: 24px;
            color: var(--title-color);
        }
        
        .titlebar .buttons .menu-button {
            background: transparent;
            border: none;
            color: var(--title-color);
            font-size: 1.5em; /* Adjust size as needed */
            cursor: pointer;
            transition: color 0.3s, transform 0.3s;
        }
        
        .titlebar .buttons .menu-button:hover {
            color: #0078d4; /* Accent color on hover */
            transform: scale(1.1); /* Slightly enlarge on hover */
        }
        
        .titlebar .buttons .menu-button:focus {
            outline: none; /* Remove default focus outline */
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2); /* Custom focus ring */
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 12px;
            background-color: var(--dropdown-background);
            min-width: 160px;
            max-width: 100%;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }
        .dropdown-content a {
            display: block;
            color: var(--text-color);
            height: 62px;
            padding: 12px;
            text-decoration: none;
        }
        .dropdown-content a:hover {
            background-color: var(--button-hover-background);
        }
        .dropdown:hover button {
            background-color: var(--button-hover-background);
            color: var(--text-color);
        }
        
        .language-selector, .theme-selector {
            border-top: solid 1px black;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .language-selector label, .theme-selector label {
            font-size: 16px;
            color: var(--text-color);
            margin-right: 10px;
        }
        
        .language-selector select, .theme-selector select {
            font-size: 16px;
            width: 180px;
            padding: 5px;
            border: 1px solid var(--input-border);
            border-radius: 5px;
            background-color: var(--input-background);
            color: var(--input-border);
        }
        .popup {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            overflow: auto;
            background-color: var(--popup-background);
            padding: 12px 24px;
            word-wrap: break-word;
            max-width: 100%;
        }
        /*.popup-content {*/
        /*    background-color: var(--popup-content-background);*/
        /*    color: var(--popup-content-color);*/
        /*    margin: 5% auto;*/
        /*    padding: 20px;*/
        /*    border: 1px solid #888;*/
        /*    width: 80%;*/
        /*    max-width: 500px;*/
        /*}*/
        .popup-close {
            color: var(--popup-content-color);
            position: absolute;
            right: 20px;
            top: 0;
            font-size: 34px;
            font-weight: bold;
        }
        .popup-close:hover, .popup-close:focus {
            color: var(--popup-content-color);
            text-decoration: none;
            cursor: pointer;
        }
        
        .hidden {
            display: none;
        }
        
         #loginScreen {
            overflow: auto;
            height: 100%;
            padding: 20px 12px;
            max-width: 100%;
        }
        
         #loginScreen h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--button-background);
            text-shadow: 0 0 10px var(--button-background);
        }
        #loginScreen .login-input-container {
            max-width: 320px;
            margin: 60px auto;
        }
        #loginScreen .login-purpose {
            margin: 40px 0;
        }
        #loginScreen input {
            display: block;
            width: calc(100% - 20px);
            margin: 10px auto;
            padding: 10px;
            border: 2px solid var(--input-border); /* Bright green border */
            border-radius: 5px;
            background-color: var(--input-background);
            color: var(--input-border);
            font-size: 16px;
        }
    
        #loginScreen input::placeholder {
            color: var(--text-color);
        }
    
        #loginScreen button {
            background-color: var(--button-background); /* Bright green for the button */
            color: var(--button-text-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0px 4px 8px var(--button-background);
            transition: background-color 0.3s, transform 0.2s;
        }
    
        #loginScreen button:hover {
            background-color: var(--button-hover-background);
        }
    
        #loginScreen button:active {
            transform: scale(0.95); /* Slight scale down on click */
        }
    
        .login-purpose {
            margin: 60px;
            max-width: 100%;
        }
        
        .dark-theme .login-purpose {
            color: var(--text-color);
            background-color: var(--background-color);
            padding: 20px;
            border: 1px solid var(--input-border);
            border-radius: 8px;
        }
        
        .dark-theme .login-purpose h1 {
            color: var(--title-color);
            margin-bottom: 10px;
        }
        
        .dark-theme .login-purpose p {
            color: var(--text-color);
        }
        
        /* Light Theme */
        .light-theme .login-purpose {
            color: var(--text-color);
            background-color: var(--background-color);
            padding: 20px;
            border: 1px solid var(--input-border);
            border-radius: 8px;
            max-width: 100%;
        }
        
        .light-theme .login-purpose h1 {
            color: var(--title-color);
            margin-bottom: 10px;
        }
        
        .light-theme .login-purpose p {
            color: var(--text-color);
        }
        
        /* Retro Theme */
        .retro-theme .login-purpose {
            max-width: 100%;
            color: var(--text-color);
            background-color: var(--background-color);
            padding: 20px;
            border: 1px solid var(--input-border);
            border-radius: 8px;
        }
        
        .retro-theme .login-purpose h1 {
            color: var(--title-color);
            margin-bottom: 10px;
        }
        
        .retro-theme .login-purpose p {
            color: var(--text-color);
        }

        /* Base styling for speech container */
        #speechContainer {
            width: 600px;
            max-width: 100%;
            height: 100px;
            display: flex;
            align-items: center;
            flex-direction: row;
            padding: 6px 12px;
            background-color: var(--receipt-background);
            color: var(--text-color);
            border-radius: 8px;
            box-shadow: var(--button-background);
            border: 1px solid var(--receipt-border-color);
            margin: 0 auto;
        }
        
        #controlSpeechButton {
            width: 50px;
            height: 50px;
            background-color: var(--button-background);
            color: var(--button-text-color);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            transition: background-color 0.3s, box-shadow 0.2s, transform 0.2s;
            flex-shrink: 0;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2), 0 2px 4px rgba(255, 255, 255, 0.1) inset;
            background-image: linear-gradient(to top, var(--button-background), lighten(var(--button-background), 20%));
            position: relative;
        }
        
        #controlSpeechButton:hover {
            background-color: var(--button-hover-background);
            box-shadow: 0 7px 12px rgba(0, 0, 0, 0.4), 0 3px 6px rgba(255, 255, 255, 0.1) inset;
            transform: translateY(-2px);
        }
        
        #controlSpeechButton:active {
            background-color: darken(var(--button-background), 15%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(255, 255, 255, 0.1) inset;
            transform: translateY(1px);
        }
        
        #controlSpeechButton[aria-pressed="true"] {
            background-color: var(--button-hover-background);
            box-shadow: 0 3px 8px rgba(0, 255, 0, 0.5), 0 2px 4px rgba(255, 255, 255, 0.2) inset;
        }
        
        #controlSpeechButton::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            pointer-events: none; /* Ensure overlay does not interfere with interactions */
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        #controlSpeechButton:hover::after {
            opacity: 0.3;
        }
        
        /* Disabled state */
        #controlSpeechButton:disabled {
            background-color: #888888;
            color: #cccccc;
            box-shadow: none;
            cursor: not-allowed;
        }

        
        
        /* Sound bars for voice detection */
        #soundBars {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-right: 20px;
            flex-shrink: 0;
            height: 30px; /* Max height for the bars */
        }
        
        #soundBars .sound-bar {
            width: 35px;
            background-color: var(--button-background);
            margin: 3px 0;
            transition: height 0.1s ease;
            height: 8px; /* Start with minimum height */
        }
        
        /* Rectangular screen for feedback and instructions */
        #instructionContainer {
            width: 100%;
            height: 100%;
            background-color: var(--titlebar-background);
            color: var(--popup-content-color);
            padding: 6px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--receipt-border-color);
        }
        
        #gameScreen {
             padding: 20px;
            width: 100%;
            max-width: 100%;
            height: 100%;
            display: none;
            position: relative;
        }
        #gameScreen.game-content {
            display: flex;
            width: 100%;
            max-width: 100%;
            height: 100%;
            flex-direction: column;
            justify-content: space-between;
        }
    
        #balanceContainer {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            width: 550px;
            max-width: 100%;
            margin: 0 auto;
            padding: 24px 12px;
        }
        #balanceCaption {
            font-size: 36px;
            color: var(--title-color);
        }
        #balance {
            font-size: 36px;
            font-weight: bold;
            color: var(--button-background);
            text-shadow: 0 0 10px var(--button-background);
        }
        #recognizedText {
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--title-color);
        }
        
        #purchaseList {
            list-style-type: none;
            padding: 0;
            width: 320px;
            max-width: 100%;
            margin: 24px auto;
            max-height: 220px;
            overflow-y: auto;
        }
        #purchaseList li {
            background-color: var(--receipt-background);
            color: var(--receipt-text-color);
            margin: 6px 0;
            padding: 8px 10px;
            border: 2px dashed var(--receipt-border-color);
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }
        #purchaseList input {
            margin-right: 10px;
            padding: 5px;
            flex-grow: 1;
            font-size: 16px;
        }
        #purchaseList button {
            background-color: var(--button-background);
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        #purchaseList button:hover {
            background-color: #ff3333;
        }
        #purchaseList .btn-remove {
            padding: 6px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
        }
        .labeled-element {
            position: relative; 
            padding-top: 20px;
        }
        .receipt-container {
            width: 300px;
            max-width: 100%;
            background-color: var(--receipt-background);
            padding: 20px;
            margin: 0 auto;
            border: 2px dashed #ccc;
            border-radius: 10px;
            font-family: 'Courier New', Courier, monospace;
            color: var(--receipt-text-color);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .receipt-header {
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .receipt-item span {
            font-size: 14px;
        }
        
        .receipt-total {
            border-top: 2px solid #ccc;
            padding-top: 10px;
            font-weight: bold;
            font-size: 16px;
        }
        
        .receipt-footer {
            text-align: center;
            font-size: 12px;
            margin-top: 20px;
            font-style: italic;
        }

        .active-control {
            box-shadow: 0 0 10px #61dafb;
            font-weight: 600;
        }
        #controlSpeechButton:active {
            background-color: #21a1f1;
            box-shadow: 0 0 5px #21a1f1;
        }
        @media (max-width: 600px) {
            .titlebar h1 {
                font-size: 20px;
            }
            #balance {
                font-size: 28px;
            }
            #controlSpeechButton {
                font-size: 16px;
                padding: 8px 16px;
            }
        }
        
        #levelUp {
            background-color: var(--button-background);
            color: var(--button-text-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.5);
            transition: background-color 0.3s, transform 0.2s;
        }
    
        #levelUp:hover {
            background-color: var(--button-hover-background);
        }
    
        #levelUp:active {
            transform: scale(0.95); 
        }
    
        #resultText {
            font-size: 20px;
            font-weight: bold;
            color: var(--button-background); /* Bright green for the game theme */
            text-shadow: 0 0 10px var(--button-background);
            text-align: center;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            #loginScreen .login-input-container {
                max-width: 100%;
                margin: 0 auto;
                padding: 10px;
            }
        
            .login-purpose {
                margin: 20px;
                padding: 15px;
            }
        
            #loginScreen h2 {
                font-size: 20px;
            }
        
            #loginScreen button {
                font-size: 16px;
                padding: 8px 16px;
            }
        }
        
        @media (max-width: 480px) {
            #loginScreen h2 {
                font-size: 18px;
                margin-bottom: 15px;
            }
        
            #loginScreen button {
                font-size: 14px;
                padding: 6px 12px;
            }
        
            .login-purpose {
                margin: 10px;
                padding: 10px;
            }
        }
        
        /*********** Notification ******************/
        #error-container {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 300px;
            z-index: 1000;
        }
        
        .notification {
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            font-family: Arial, sans-serif;
            color: #fff;
            font-size: 14px;
            opacity: 0;
            transform: translateY(-20px);
            transition: transform 0.5s ease, opacity 0.5s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.hide {
            opacity: 0;
            transform: translateY(-20px);
        }
        
        .error {
            background-color: #f8d7da; /* Light red background */
            border: 1px solid #f5c6cb; /* Light red border */
            color: #721c24; /* Dark red text */
        }
        
        .warning {
            background-color: #fff3cd; /* Light yellow background */
            border: 1px solid #ffeeba; /* Light yellow border */
            color: #856404; /* Dark yellow text */
        }
        
        .message {
            background-color: #d1ecf1; /* Light blue background */
            border: 1px solid #bee5eb; /* Light blue border */
            color: #0c5460; /* Dark blue text */
        }
        
        .notification button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: inherit;
            font-size: 16px;
            cursor: pointer;
        }
        
        .notification button:hover {
            opacity: 0.8;
        }

        /*********** Notification ******************/
    </style>
</head>
<body class="dark-theme">

    <div class="titlebar">
        <div class="title">Imagine Act</div>
        <div class="buttons">
            <button>🔍</button>
            <button>✏️</button>
            <button id="btn_menu" aria-label="Menu" class="menu-button">☰</button>
            <div class="dropdown">
                <div class="dropdown-content" id="dropdown_content">
                    <a href="#" id="aboutLink">About</a>
                    <a href="#" id="resetGame">Reset Game</a>
                    
                    <a href="#" class="language-selector">
                        <label for="language">Choose language:</label>
                        <select id="language">
                            <option value="en-US">American English</option>
                            <option value="en-GB">British English</option>
                        </select>
                    </a>
                    <a href="#" class="theme-selector">
                        <label for="theme">Themes:</label>
                        <select id="theme">
                            <option value="dark-theme">Dark</option>
                            <option value="light-theme">Light</option>
                            <option value="retro-theme">Retro</option>
                        </select>
                    </a>
                </div>
                
            </div>
            
        </div>
    </div>
    <div id="error-container"></div>
    <div id="loginScreen" class="login-screen hidden">
        <div class="login-input-container">
            <h2>Login</h2>
            <input type="text" id="username" placeholder="Display name">
            <input type="number" id="initialDeposit" placeholder="Initial Deposit" min="0" step="1.00">
            <input list="currencies" id="currency" name="currency" placeholder="Choose your currency">
            <datalist id="currencies">
                <option value="$">USD - US Dollar</option>
                <option value="€">EUR - Euro</option>
                <option value="£">GBP - British Pound</option>
                <option value="¥">JPY - Japanese Yen</option>
                <option value="R">ZAR - South African Rand</option>
                <option value="$">CAD - Canadian Dollar</option>
                <option value="$">AUD - Australian Dollar</option>
                <option value="CHF">CHF - Swiss Franc</option>
                <option value="¥">CNY - Chinese Yuan</option>
                <option value="₹">INR - Indian Rupee</option>
            </datalist>
            <button id="loginButton">Let's start</button>
        </div>
        <div class="login-purpose">
            <h2>Welcome to Imagine Act</h2>
            <p>
                Imagine Act (IA) is a unique, interactive game designed to help you visualize and work towards your financial goals in a fun and engaging way. Using your imagination and voice commands, you can "buy" items and create lists, connecting mentally and emotionally with the idea of wealth and abundance.
            </p>
        
            <p><strong>Key Features:</strong></p>
            <ul>
                <li><strong>Visualization of Wealth:</strong> Experience the feeling of wealth by spending virtual currency on desired items.</li>
                <li><strong>Gamification of Financial Goals:</strong> Progress through levels where your virtual currency doubles each time you successfully complete a level.</li>
                <li><strong>Mindset Training:</strong> Reinforce positive beliefs about money and abundance, using concepts from the laws of the universe to bring positive benefits into your reality.</li>
                <li><strong>User Engagement:</strong> Enjoy a more personalized experience with User Artificial Intelligence (UAI) and GPT integration.</li>
            </ul>
        
            <p><strong>How to Play:</strong></p>
            <ul>
                <li><strong>Starting the Game:</strong> Enter your display name and initial deposit (starting balance) on the login screen and click "Let’s start" to begin.</li>
                <li><strong>Buying Items:</strong> Use voice commands to buy items by stating, "I [buy/purchase/get/pay for/acquire] [item name] for [amount] [currency]." For example, "I buy a laptop for 1,000 [currency]."</li>
                <li><strong>Managing Your Balance:</strong> Your virtual balance updates with each purchase, and successful transactions are listed like a receipt.</li>
                <li><strong>Game Controls:</strong> Use voice commands for interactions, or the dropdown menu at the top for options like viewing game information or resetting the game.</li>
                <li><strong>Editing/Removing Items:</strong> You can modify or remove items from your list using voice commands. For example, "Edit the laptop to gaming laptop" or "Remove the laptop."</li>
            </ul>
        
            <p><strong>Possible Voice Commands</strong></p>
            <ul>
                <li>I buy [item] for [amount]</li>
                <li>I purchase [item] for [amount]</li>
                <li>I get [item] for [amount]</li>
                <li>I pay for [item] with [amount]</li>
                <li>I acquire [item] for [amount]</li>
                <li>I obtain [item] for [amount]</li>
                <li>I order [item] for [amount]</li>
                <li>I book [item] for [amount]</li>
                <li>I reserve [item] for [amount]</li>
                <li>I take [item] for [amount]</li>
                <li>I give away [item]</li>
                <li>I give [item]</li>
                <li>Remove [item]</li>
                <li>Delete [item]</li>
                <li>Drop [item]</li>
                <li>Cancel [item]</li>
                <li>Discard [item]</li>
                <li>Erase [item]</li>
                <li>Eliminate [item]</li>
                <li>Clear [item]</li>
                <li>Take out [item]</li>
            </ul>
            
            <p><strong>Additional Features:</strong></p>
            <ul>
                <li><strong>Responsive Design:</strong> The game interface adapts to different screen sizes, including mobile devices.</li>
                <li><strong>Language Selector:</strong> Choose between different English dialects (American or British) for voice recognition.</li>
            </ul>
        
            <p>
                Imagine Act is more than just a game—it's a tool for personal growth and empowerment, helping you develop a prosperous mindset that can lead to real-life success.
            </p>
        </div>
    </div>

    <div id="gameScreen" class="game-screen">
        <div class="game-content">
            <div id="speechContainer">
                <button id="controlSpeechButton" aria-pressed="false">🎤</button>
                <div id="soundBars">
                    <div class="sound-bar"></div>
                    <div class="sound-bar"></div>
                    <div class="sound-bar"></div>
                    <div class="sound-bar"></div>
                    <div class="sound-bar"></div>
                </div>
                
                <div id="instructionContainer">
                    <div id="recognizedText">Listening <br/>Try saying "I buy bread for 17 [currency]"</div>
                </div>
            </div>
            
            <div id="balanceContainer">
                <div id="balanceCaption">Balance</div>
                <div id="balance"><span id="balanceAmount">0.00</span></div>
            </div>
            <div class="receipt-container">
                <div class="receipt-header" id="starting_balance"></div>
                <div class="receipt-header">Successful Purchases</div>
                <ul class="labeled-element" id="purchaseList"></ul>
                <div class="receipt-footer">Thank you for shopping with us! The more you play and believe in the game the more you will seee it actualize in your experience.</div>
            </div>
        </div>
    </div>
    <div id="aboutPopup" class="popup">
        <span class="popup-close">&times;</span>
        <h2>About the Game</h2>
        <p><strong>Welcome to Imagine Act!</strong></p>
        <ul>
            <li>The goal is to use your imagination and believe in making purchases real in your reality.</li>
            <li>The more you play, the more likely you are to buy items for real. Make each purchase as realistic as possible.</li>
        </ul>

        <p><strong>Overview of the Game:</strong></p>
        <ul>
            <li><strong>Theme:</strong> Retro, arcade-inspired appearance with a dark theme, bright colors, and nostalgic fonts.</li>
            <li><strong>Objective:</strong> Manage your virtual balance while making purchases using voice commands. The game tracks your balance and displays your bought items.</li>
        </ul>

        <p><strong>How to Play:</strong></p>
        <ul>
            <li><strong>1. Start the Game:</strong>
                <ul>
                    <li>Enter your display name and initial deposit (starting balance) on the login screen.</li>
                    <li>Click <em>"Let’s start"</em> to proceed to the main game screen.</li>
                </ul>
            </li>
            <li>
                <h3>2. Buying/Acquiring/Paying for an Item</h3>
                <h4>How to Speak It:</h4>
                <p>
                    <strong>Basic Format:</strong> "I [buy/purchase/get/pay for/acquire/obtain/order/book/reserve/take/give away/give] [item name] for [amount] [currency]."
                </p>
                <p><strong>Examples:</strong></p>
                <ul>
                    <li>"I buy a laptop for 1,000 [currency]."</li>
                    <li>"I purchase the book for 15 [currency]."</li>
                    <li>"I get a car for fifty thousand [currency]."</li>
                    <li>"I pay for a meal for twenty [currency]."</li>
                    <li>"I acquire a house for 250,000 [currency]."</li>
                    <li>"I reserve a hotel room for one hundred [currency]."</li>
                    <li>"I take the package for 75 [currency]."</li>
                </ul>
                <p><strong>Notes:</strong></p>
                <ul>
                    <li>The command must start with "I" followed by any of the listed verbs.</li>
                    <li>The item name can be anything, and the amount can be a numeric value or a spelled-out number.</li>
                    <li>The currency can be optional but if included, it can be in various formats like dollars, euros, pounds, etc.</li>
                </ul>
            </li>
            <li>
                <h3>3. Removing an Item</h3>
                <h4>How to Speak It:</h4>
                <p><strong>Basic Format:</strong> "[remove/delete/drop/cancel/discard/erase/eliminate/clear/take out] [item name]" or "[Item name] [remove/delete/drop/cancel/discard/erase/eliminate/clear/take out]."</p>
                <p><strong>Examples:</strong></p>
                <ul>
                    <li>"Remove the laptop."</li>
                    <li>"Delete the booking."</li>
                    <li>"Drop the reservation."</li>
                    <li>"Cancel the order."</li>
                    <li>"Erase the meal from the list."</li>
                    <li>"Take out the package."</li>
                    <li>"The hotel room, remove."</li>
                </ul>
                <p><strong>Notes:</strong></p>
                <ul>
                    <li>This command can be phrased either by starting with the action verb followed by the item or by stating the item first followed by the action verb.</li>
                    <li>The item name should correspond to something already in your list or inventory.</li>
                </ul>
            </li>
            <li><strong>Balance Management:</strong> Your virtual balance updates based on your purchases, subtracting the spent amount.</li>
            <li><strong>Receipt Display:</strong> Successful purchases are listed in a receipt format, showing what you've bought.</li>
            <li><strong>Controls:</strong>
                <ul>
                    <li><strong>Speech Recognition:</strong> Control the game through voice commands. Press the <em>"Start"</em> button to activate the voice command feature.</li>
                    <li><strong>Menu Options:</strong> Use the dropdown menu at the top to view game information (<em>"About"</em>) or reset the game to start over.</li>
                </ul>
            </li>
        </ul>
        <p><strong>Winning/Losing:</strong></p>
        <ul>
            <li>There’s no traditional win/lose condition. Focus on managing your balance while interacting with the system. The game could end when you run out of money or decide to stop playing.</li>
        </ul>
        <p><strong>Additional Features:</strong></p>
        <ul>
            <li><strong>Language Selector:</strong> Choose between different English dialects (American or British) for voice recognition.</li>
            <li><strong>Responsive Design:</strong> The interface adapts to different screen sizes, including mobile devices.</li>
        </ul>

        <p><strong>In summary,</strong> Imagine Act is an interactive shopping simulation game where you use your voice to buy items and manage your balance. It offers an engaging way to practice decision-making and budgeting in a virtual environment.</p>
        <br/><br/><br/>
        
    </div>

    <script>
        let balance = 0;
        let recognitionActive = false;
        let initialDeposit = 0;
        let selectedCurrency = '';
        let selectedCurrencyName = 'Rand';
        
        function setTheme(theme) {
            document.body.classList.remove('dark-theme', 'light-theme', 'retro-theme');
            // Add the selected theme class
            document.body.classList.add(theme);
            localStorage.setItem('theme', theme);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const elemResetGame = document.getElementById('resetGame');
            
            const loginScreen = document.getElementById('loginScreen');
            const loginButton = document.getElementById('loginButton');
            
            const gameScreen = document.getElementById('gameScreen');
            const starting_balance = document.getElementById('starting_balance');
            const balanceAmount = document.getElementById('balanceAmount');
            const purchaseList = document.getElementById('purchaseList');
            
            const dropdown_content = document.getElementById('dropdown_content');
            const btn_menu = document.getElementById('btn_menu');
            const aboutLink = document.getElementById('aboutLink');
            const aboutPopup = document.getElementById('aboutPopup');
            const popupClose = document.querySelector('.popup-close');
            const soundBars = document.querySelectorAll('.sound-bar');
            
            const controlSpeechButton = document.getElementById('controlSpeechButton');
            const recognizedTextLabel = document.getElementById('recognizedText');
            const languageSelect = document.getElementById('language');
            const themeSelect = document.getElementById('theme');
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                console.log('Speech Recognition API is not supported in this browser.');
                alert('Speech Recognition API is not supported in this browser.');
                return;
            }
            const recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.lang = "en-US";
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            
            languageSelect.addEventListener('change', () => {
                recognitionLang = languageSelect.value;
                recognition.lang = recognitionLang;
                if (recognitionActive) {
                    stopVoiceRecognition();
                    recognition.onend = () => { 
                        startVoiceRecognition();
                    };
                }
            });
            themeSelect.addEventListener('change', () => {
                setTheme(themeSelect.value);
            });
            
            initializeGame();
            
            function initializeGame() {
                const theme = localStorage.getItem('theme');
                if (theme) {
                    setTheme(theme);
                    themeSelect.value = theme;
                }
            
                const storedUsername = localStorage.getItem('username');
                const storedBalance = parseFloat(localStorage.getItem('balance'));
                
                // Only parse initialDeposit and storedCurrency if username and balance are valid
                if (storedUsername && !isNaN(storedBalance)) {
                    initialDeposit = parseFloat(localStorage.getItem('initialDeposit'));
                    const storedCurrency = JSON.parse(localStorage.getItem('currency'));
            
                    if (isCurrencyObject(storedCurrency)) {
                        selectedCurrency = storedCurrency;
                        selectedCurrencyName = getLastWord(selectedCurrency.name);
                        console.log('selectedCurrencyName: ' + selectedCurrencyName);
                    } else {
                        console.log('storedCurrency is not an object.');
                        alert(JSON.stringify(storedCurrency));
                        setDefaultCurrency();
                    }
            
                    starting_balance.textContent = `Initial Balance: ${selectedCurrency.symbol}${parseFloat(initialDeposit)}`;
                    balance = storedBalance;
                    balanceAmount.textContent = `${selectedCurrency.symbol}${balance.toFixed(2)}`;
                    loadPurchases();
            
                    loginScreen.style.display = 'none';
                    gameScreen.style.display = 'block';
                    
                    initSpeechRecognition();
                    showNote('message', 'Start Imagine Act with the speech button');
                } else {
                    loginScreen.style.display = 'block';
                    gameScreen.style.display = 'none';
                }
            }

            loginButton.addEventListener('click', () => {
                const username = document.getElementById('username').value;
                initialDeposit = parseFloat(document.getElementById('initialDeposit').value);
                
                const currencyInput = document.getElementById('currency');
                const selectedCurrencySymbol = currencyInput.value;
                console.log('selectedCurrencySymbol: ' + selectedCurrencySymbol);
                let selectedCurrencyObj = null;
                
                const datalistOptions = document.querySelectorAll('#currencies option');
                console.log(JSON.stringify(datalistOptions));
                
                datalistOptions.forEach(option => {
                    if (option.value === selectedCurrencySymbol) {
                        const currencyName = option.textContent.split(' - ')[1];
                        selectedCurrencyObj = {
                            name: currencyName,
                            symbol: selectedCurrencySymbol
                        };
                        console.log('selectedCurrencyText: ' + option.textContent);
                    }
                });
            
                if (selectedCurrencyObj) {
                    localStorage.setItem('currency', JSON.stringify(selectedCurrencyObj));
                    selectedCurrency = selectedCurrencyObj;
                    console.log('selectedCurrency is saved to storage: ' + JSON.stringify(selectedCurrency));
                } else {
                    alert('Please select a valid currency.');
                    return;
                }
            
                if (!initialDeposit || initialDeposit <= 0) {
                    alert('You have to start with an initial balance.');
                    return;
                }
            
                if (!username || isNaN(initialDeposit) || !selectedCurrency) {
                    alert('Kindly fill in all fields to initialize the game.');
                    return;
                }
            
                localStorage.setItem('username', username);
                localStorage.setItem('balance', initialDeposit.toFixed(2));
                localStorage.setItem('initialDeposit', initialDeposit.toFixed(2));
                
                localStorage.setItem('purchases', JSON.stringify([]));
                balance = initialDeposit;
                
                balanceAmount.textContent = `${selectedCurrency.symbol}${balance.toFixed(2)}`;
                starting_balance.textContent = `Initial Balance: ${selectedCurrency.symbol}${parseFloat(initialDeposit)}`;
                
                loginScreen.style.display = 'none';
                gameScreen.style.display = 'block';
            });

            
            function setDefaultCurrency() {
                selectedCurrency = { name: 'ZAR - South African Rand', symbol: 'R' };
                localStorage.setItem('currency', JSON.stringify(selectedCurrency));
                recognizedTextLabel.textContent = 'The currency is set to the default - Rand.';
            }
            
            // Handle reset game
            elemResetGame.addEventListener('click', () => {
                resetGame();
            });
            function resetGame() {
                localStorage.removeItem('username');
                localStorage.removeItem('balance');
                localStorage.removeItem('purchases');
                localStorage.removeItem('currency');
                location.reload();
            }
            
            
            aboutLink.addEventListener('click', () => {
                dropdown_content.style.display = 'none';
                aboutPopup.style.display = 'block';
            });
            btn_menu.addEventListener('click', () => {
                toggleMenuPopup();
            });
            function toggleMenuPopup() {
                if (dropdown_content.style.display === 'none' || dropdown_content.style.display === '') {
                    dropdown_content.style.display = 'block';
                } else {
                    dropdown_content.style.display = 'none';
                }
            }
            
            popupClose.addEventListener('click', () => {
                aboutPopup.style.display = 'none';
            });

            window.onclick = (event) => {
                if (event.target === aboutPopup) {
                    aboutPopup.style.display = 'none';
                }
                if (!btn_menu.contains(event.target) && !dropdown_content.contains(event.target)) {
                    dropdown_content.style.display = 'none';
                }
            };
            
            controlSpeechButton.addEventListener('click', () => {
                if (recognitionActive) {
                    stopVoiceRecognition();
                } else {
                    startVoiceRecognition();
                }
            });
            
            function initSpeechRecognition() {
                recognition.addEventListener('result', (event) => {
                    console.log('yes');
                    const speechResult = event.results[event.resultIndex][0].transcript.trim();
                    // recognizedTextLabel.textContent = `You said: "${speechResult}"`;
                    
                    const accuracy = processVoiceCommand(speechResult);
                    
                    console.log(`Accuracy:${accuracy} speechResult: ${speechResult}`);
            
                    if (soundBars.length > 0) {
                        updateSoundBars(accuracy);
                    }
                });
                recognition.onend = () => { 
                    if (recognitionActive) {
                        console.log('Restarting speech recognition...');
                        startVoiceRecognition();
                    }
                };
                recognition.onerror = function(event) {
                    stopVoiceRecognition();
                    showNote('error', 'Speech recognition error detected: ' + event.error ? event.error : 'unknown');
                }; 
            }
            
            function startVoiceRecognition() {
                recognitionActive = true;
                recognition.start();
                controlSpeechButton.classList.add('active-control');
                recognizedTextLabel.textContent = 'Listening';
            
            }
            function stopVoiceRecognition() {
                recognitionActive = false;
                recognition.stop();
                controlSpeechButton.classList.remove('active-control');
                
                recognizedTextLabel.textContent = "Sleeping<br>Press on the Speech button to start vlagain.";


            }
            
            let currentPurchase = '';
            
            function processVoiceCommand(text) {
                if (text.toLowerCase() === 'stop listening') {
                    stopVoiceRecognition();
                    return 100; // No accuracy needed for stopping
                }
                
                const removeRegex = /(?<=\b(remove|delete|drop|cancel|discard|erase|eliminate|clear|take\sout)\s)(.*)/i;
                const removeMatch = text.match(removeRegex);
                
                if (removeMatch) {
                    const item = removeMatch[1].trim();
                    console.log('Removing item:', item);
                    // Assume we have a function to check if the item is in the list
                    if (isItemNameInPurchaseList(item)) {
                        removeItemFromPurchaseList(item);
                        return 100; // Full accuracy for this command
                    } else {
                        recognizedTextLabel.textContent = `Item ${item} not found`;
                        return 60; // Partial accuracy for incorrect item
                    }
                }
                
                if (!text.match(/\bI\b/i)) {
                    console.log('Command does not start with "I"');
                    return 20;
                }
            
                const captureResult = extractDetails(text);
                console.log(`Item: ${captureResult.item}, Amount: ${captureResult.amount}, Currency: ${captureResult.currency}`);
                const nonNullCount = Object.values(captureResult).filter(value => value !== null).length;
                
                if (captureResult.currency !== selectedCurrencyName) {
                    showNote('warning', 'Invalid currency. value: ' + captureResult.currency);
                    return (nonNullCount + 1) * 20;
                } else if (nonNullCount < 3) {
                    showNote('warning', `Missing information in your purchase. Item: ${captureResult.item}, Amount: ${captureResult.amount}, Currency: ${captureResult.currency}`);
                    return (nonNullCount + 1) * 20;
                } else if (nonNullCount === 3) {
                    const item = captureResult.item.replace(selectedCurrency.symbol, '');
                    const amountText = captureResult.amount;
                    let amount;
            
                    if (/^\d/.test(amountText)) {
                        amount = parseFloat(amountText.replace(/,/g, ''));
                    } else {
                        amount = wordsToNumbers(amountText.toLowerCase());
                    }
            
                    if (isNaN(amount)) {
                        console.log('Invalid amount');
                        showNote('warning', 'Invalid amount. value: ' + amount);
                        
                        return 60; // Partial accuracy for invalid amount
                    } else if (amount <= balance) {
                        if (!isItemInPurchaseList(item, amount)) {
                            balance -= amount;
                            balanceAmount.textContent = `${selectedCurrency.symbol}${balance.toFixed(2)}`;
                            localStorage.setItem('balance', balance.toFixed(2));
                            addItemToPurchaseList(item, amount);
                            return 100; // Full accuracy for valid purchase
                        }
                    } else {
                        showNote('warning', 'Insufficient balance');
                        console.log('Insufficient balance');
                        return 60; // Partial accuracy for insufficient balance
                    }
                } else {
                    showNote('warning', 'Insufficient balance');
                    console.log('No match found for the input text.');
                    return 40; // Low accuracy for unrecognized command
                }
            }

            function isNumber(value) {
                return !isNaN(Number(value));
            }
            function handleZeroBalance() {
                console.log('balance is less than 0. balance: ' + balance);
                controlSpeechButton.classList.remove('active-control');
                
                localStorage.removeItem('purchases');
                
                doubleBalanceAndProceed();
                
                purchaseList.innerHTML = '';
            }
            
            function addItemToPurchaseList(item, amount) {
                if ((!amount || amount <= 0)) {
                    recognizedTextLabel.textContent = "Invalid item amount.";
                    return false;
                }
                if (!item) {
                    recognizedTextLabel.textContent = "Invalid item name.";
                    return false;
                }
                
                const li = document.createElement('li');
                li.textContent = `${item} - ${selectedCurrency.symbol}${amount.toFixed(2)}`;
                const removeButton = document.createElement('button');
                removeButton.classList.add('btn-remove');
                removeButton.textContent = "X";
                removeButton.addEventListener('click', () => {
                    removePurchase(item, amount);
                    
                    
                    loadPurchases();
                });
                li.appendChild(removeButton);
                purchaseList.appendChild(li);
                const lastItem = purchaseList.lastElementChild;
                if (lastItem) {
                    lastItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
                
                savePurchasesToLocalStorage();
                
                return true
            }
            function isItemInPurchaseList(itemToFind, amountToFind) {
                const purchases = JSON.parse(localStorage.getItem('purchases')) || [];
                const index = purchases.findIndex(
                    (element) => element.item === itemToFind && element.amount === amountToFind
                );
                
                // If index is not found, return false
                if (index === -1) {
                    return false;
                } 
                
                return true;
            }
            function isItemNameInPurchaseList(itemToFind) {
                const purchases = JSON.parse(localStorage.getItem('purchases')) || [];
                const index = purchases.findIndex((element) => element.item === itemToFind);
                
                // If index is not found, return false
                if (index === -1) {
                    return false;
                } 
                
                return true;
            }

            function loadPurchases() {
                purchaseList.innerHTML = '';
                
                const purchases = JSON.parse(localStorage.getItem('purchases')) || [];
                purchases.forEach(purchase => {
                    console.log(purchase.item, purchase.amount);
                    addItemToPurchaseList(purchase.item, purchase.amount);
                });
            }

            function savePurchasesToLocalStorage() {
                let purchases = [];
                
                // Read each item from the purchase list
                purchaseList.querySelectorAll('li').forEach(li => {
                    // Get the item and amount from the text content
                    const itemText = li.textContent.replace("Remove", "").trim();
                    const [item, amountText] = itemText.split(` - ${selectedCurrency.symbol}`);
                    const amount = parseFloat(amountText);
            
                    // Add the item and amount to the purchases array
                    purchases.push({ item: item.trim(), amount: amount });
                });
            
                // Save the purchases array to local storage
                localStorage.setItem('purchases', JSON.stringify(purchases));
            }
            
            function removePurchase(itemToRemove, amountToRemove) { [];
                const purchases = JSON.parse(localStorage.getItem('purchases')) || [];
                if (purchases.length > 0) {
                    const index = purchases.findIndex(
                        (element) => element.item === itemToRemove && element.amount === amountToRemove
                    );
                    
                    // If index is not found, return false
                    if (index === -1) {
                        recognizedTextLabel.textContent = "The item to remove was not found in the purchase list.";
                        return false;
                    }
                    
                    // Remove the item from the purchases
                    purchases.splice(index, 1);
                    
                    localStorage.setItem('purchases', JSON.stringify(purchases));
                    balance += amount;
                    balanceAmount.textContent = `${selectedCurrency.symbol}${balance.toFixed(2)}`;
                    localStorage.setItem('balance', balance.toFixed(2));
                    recognizedTextLabel.textContent = `Item ${item} removed.`;
                } else {
                    recognizedTextLabel.textContent = "Purchase list is empty.";
                }
            }

            function doubleBalanceAndProceed() {
                initialDeposit *= 2;
                balance = initialDeposit;
                balanceAmount.textContent = balance.toFixed(2);
                recognizedTextLabel.textContent = `Congratulations! You have completed this level. Your balance has been doubled to ${selectedCurrency.symbol}${balance.toFixed(2)} for the next level.`;
                localStorage.setItem('balance', balance.toFixed(2));
                localStorage.setItem('initialDeposit', initialDeposit.toFixed(2));
                
                
                // setTimeout(() => {
                //     promptRepeatPhrase().then((success) => {
                //         if (success) {
                //             initialDeposit *= 1.5;
                //             balance = initialDeposit;
                //             balanceAmount.textContent = balance.toFixed(2);
                //             localStorage.setItem('balance', balance.toFixed(2));
                //             localStorage.setItem('initialDeposit', initialDeposit.toFixed(2));     
                //             recognizedTextLabel.textContent = `Well done! Your balance has increased to ${selectedCurrency.symbol}${balance.toFixed(2)} for the next level.`;
                //         } else {
                //             console.log("The operation was declined.");
                //         }
                //     });} , 3000);
            }

            
            window.removeItem = function (button) {
                console.log('window.removeItem = function (button) {');
                const li = button.parentElement;
                const item = li.querySelector('input').value;
                const amount = parseFloat(li.querySelector('button').previousSibling.textContent.replace('R', '').trim());

                purchaseList.removeChild(li);

                // Update local storage
                balance += amount;
                balanceAmount.textContent = balance.toFixed(2);
                localStorage.setItem('balance', balance.toFixed(2));
            };
            
            function removeItemFromPurchaseList(item) {
                const listItems = purchaseList.getElementsByTagName('li');
                for (let i = 0; i < listItems.length; i++) {
                    if (listItems[i].textContent.toLowerCase() == item.toLowerCase()) {
                        const amount = parseFloat(listItems[i].textContent.split(' - R')[1]);
                        console.log('item to remove found. item: ' + item + ' amount: ' + amount);
                        recognizedTextLabel.textContent = `${Item} found. Removing...`;
                        removePurchase(item, amount);
                        loadPurchases();
                        return;
                    }
                }
                recognizedTextLabel.textContent = `${Item} not found.`;
            }
            function wordsToNumbers(words) {
                const numberMap = {
                    "one": 1, "two": 2, "three": 3, "four": 4, "five": 5, "six": 6, "seven": 7, "eight": 8, "nine": 9, "ten": 10,
                    "eleven": 11, "twelve": 12, "thirteen": 13, "fourteen": 14, "fifteen": 15, "sixteen": 16, "seventeen": 17, "eighteen": 18, "nineteen": 19,
                    "twenty": 20, "thirty": 30, "forty": 40, "fifty": 50, "sixty": 60, "seventy": 70, "eighty": 80, "ninety": 90,
                    "hundred": 100, "thousand": 1000, "million": 1000000, "billion": 1000000000, "trillion": 1000000000000
                };
            
                let result = 0;
                let current = 0;
            
                words.split(/\s+/).forEach(word => {
                    if (numberMap[word] !== undefined) {
                        current += numberMap[word];
                    } else if (word === "hundred" && current !== 0) {
                        current *= numberMap[word];
                    } else if (numberMap[word]) {
                        current = numberMap[word];
                    } else {
                        result += current;
                        current = 0;
                    }
                });
            
                result += current;
                console.log('currency name: ' + result);
                return result;
            }
        });
        
        
        let repeatCount = 0;
        const targetCount = 10;
        
        function promptRepeatPhrase() {
            return new Promise((resolve) => {
                // Create a prompt asking the user to accept or decline
                const userResponse = confirm("Would you like to repeat the phrase 'I appreciate the money coming to me from multiple sources' 10 times for an added bonus?");
                
                if (!userResponse) {
                    resolve(false);
                    return;
                }
        
                // Start listening for the phrase
                repeatCount = 0;
                function handlePhraseDetected(text) {
                    if (text.includes("I appreciate the money coming to me from multiple sources")) {
                        repeatCount++;
                        console.log(`Phrase repeated ${repeatCount} times`);
                        
                        if (repeatCount >= targetCount) {
                            resolve(true);
                        }
                    }
                }
        
                // Override the processVoiceCommand function to include our logic
                function customProcessVoiceCommand(text) {
                    console.log('text: ' + text);
                    processVoiceCommand(text); // Call existing logic
                    
                    // Handle the repetition of the phrase
                    handlePhraseDetected(text);
                }
                
                // Override the processVoiceCommand function
                window.processVoiceCommand = customProcessVoiceCommand;
            });
        }
        
        function simulateVoiceCommand(commandText) {
            console.log('Simulated Command: ' + commandText);
            processVoiceCommand(commandText);
        }
        
        function isCurrencyObject(obj) {
            return obj && typeof obj === 'object' && obj.hasOwnProperty('name') && obj.hasOwnProperty('symbol');
        }
        
        function getLastWord(str) {
            if (typeof str !== 'string' || str.trim().length === 0) {
                return null; // or handle the case where the input is not a valid string
            }
            const words = str.trim().split(/\s+/); // Split by one or more spaces
            return words[words.length - 1];
        }

        function updateSoundBars(accuracy) {
            console.log(accuracy);
            const soundBars = document.querySelectorAll('.sound-bar');
        
            if (soundBars.length === 0) {
                console.warn('No sound bars found');
                return;
            }
            
            try {
                if (accuracy >= 0 && accuracy < 0 ) {
                    soundBars[0].style.opacity = 1;
                    soundBars[1].style.opacity = 0;
                    soundBars[2].style.opacity = 0;
                    soundBars[3].style.opacity = 0;
                    soundBars[4].style.opacity = 0;
                } else if (accuracy >- 20 && accuracy < 40 ) {
                    soundBars[0].style.opacity = 1;
                    soundBars[1].style.opacity = 1;
                    soundBars[2].style.opacity = 0;
                    soundBars[3].style.opacity = 0;
                    soundBars[4].style.opacity = 0;
                } else if (accuracy >= 40 && accuracy < 60 ) {
                    soundBars[0].style.opacity = 1;
                    soundBars[1].style.opacity = 1;
                    soundBars[2].style.opacity = 1;
                    soundBars[3].style.opacity = 0;
                    soundBars[4].style.opacity = 0;
                    soundBars[5].style.opacity = 0;
                } else if (accuracy >= 60 && accuracy < 80 ) {
                    soundBars[0].style.opacity = 1;
                    soundBars[1].style.opacity = 1;
                    soundBars[2].style.opacity = 1;
                    soundBars[3].style.opacity = 1;
                    soundBars[4].style.opacity = 0;
                } else if (accuracy >= 80 && accuracy < 1000 ) {
                    soundBars[0].style.opacity = 1;
                    soundBars[1].style.opacity = 1;
                    soundBars[2].style.opacity = 1;
                    soundBars[3].style.opacity = 1;
                    soundBars[4].style.opacity = 1;
                } else {
                    console.log('no if condition for accurancy value');
                }
            } catch (ex) {
                showNote('warning', 'Accuracy exception.');
            }
        
           
        }


        
        // startAutomationTest();
        
        function startAutomationTest() {
            processVoiceCommand('I give away 20 dollars');
            processVoiceCommand('I give 20 dollars away.');
            processVoiceCommand('I give 20 dollars away.');
            const items = [
                { name: 'Apple', price: 10 },
                { name: 'Act', price: 10 },
                { name: 'Orange', price: 15 },
                { name: 'Bread', price: 20 },
                { name: 'Milk', price: 25 },
                { name: 'Cheese', price: 30 }
            ];
            
            let itemIndex = 0;
            const intervalId = setInterval(() => {
                if (itemIndex < items.length) {
                    const item = items[itemIndex];
                    if (balance >= item.price) {
                        balance -= item.price;
                        balanceAmount.textContent = balance.toFixed(2);
                        console.log('I buy ' + item.name + ' for '+ item.price + ' ' + selectedCurrencyName);
                        processVoiceCommand('I buy ' + item.name + ' for '+ item.price + ' ' + selectedCurrencyName);
                    } else {
                        recognizedTextLabel.textContent = `Insufficient balance to purchase "${item.name}".`;
                        clearInterval(intervalId);
                    }
                    itemIndex++;
                } else {
                    itemIndex = 0;
                }
            }, 3000);
        }
        
        /**
         * Shows a notification message
         * @param {string} type - The type of notification ('error', 'warning', or 'message')
         * @param {string} message - The message to display
         */
        function showNote(type, message) {
            // Validate the type
            const validTypes = ['error', 'warning', 'message'];
            if (!validTypes.includes(type)) {
                console.error('Invalid notification type.');
                showNote('error', 'Invalid notification type.');
                return;
            }
        
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <button onclick="this.parentElement.remove()">×</button>
                ${message}
            `;
        
            // Add the notification to the container
            const notificationContainer = document.getElementById('error-container');
            notificationContainer.appendChild(notification);
        
            // Slide down by adding the 'show' class
            setTimeout(() => {
                notification.classList.add('show');
            }, 10); // Slight delay to trigger the transition
        
            // Auto-hide the notification after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show'); // Slide up by removing the 'show' class
                notification.classList.add('hide');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 500); // Wait for the slide-up animation to complete
            }, 5000);
        }

        function extractDetails(text) {
            const itemRegex = /(?:I buy|I purchase|I get|I pay for|I acquire|I order)\s+(?:a |an |the )?(?:\d+\s+)?([a-zA-Z\s]+?)(?=\sfor|\s\d+)/i;
            const amountRegex = /\b(\d+(?:,\d{3})*(?:\.\d{2})?|one|two|three|four|five|six|seven|eight|nine|ten|eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen|twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|hundred|thousand|million)\b/i;
            const currencyRegex = /\b(R|Rand|USD|Dollar|Euro)\b/i; // You can extend this for more currencies
        
            const itemMatch = text.match(itemRegex);
            const amountMatch = text.match(amountRegex);
            const currencyMatch = text.match(currencyRegex);
        
            const item = itemMatch ? itemMatch[1].trim() : null;
            const amount = amountMatch ? amountMatch[1].trim() : null;
            const currency = currencyMatch ? currencyMatch[1].trim() : null;
        
            console.log("Item:", item);
            console.log("Amount:", amount);
            console.log("Currency:", currency);
        
            return {
                item,
                amount,
                currency
            };
        }
    </script>
</body>
</html>
